<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—èªå ‚ç”Ÿæ´»å…¬å¼ï¼š16å‹äººæ ¼æ¸¬é©—</title>
    
    <!-- SEO & Social Media Meta Tags -->
    <meta name="description" content="ç¾å¯¦æ¸›å¤¢æƒ³ç­‰æ–¼ç¦½ç¸ï¼Œç¾å¯¦åŠ å¤¢æƒ³åŠ å¹½é»˜ç­‰æ–¼æ™ºæ…§ã€‚æœ¬æ¸¬é©—è‡´æ•¬æ—èªå ‚ã€Šç”Ÿæ´»çš„è—è¡“ã€‹ï¼Œé€é R+D+H+S å››å¤§ç¶­åº¦ï¼Œèª¿é…å‡ºå°ˆå±¬æ–¼ä½ çš„éˆé­‚æ–¹ç¨‹å¼ï¼Œè§£æ 16 ç¨®ç¨ç‰¹çš„ç”Ÿæ´»å§¿æ…‹ã€‚">
    <meta name="keywords" content="æ—èªå ‚, ç”Ÿæ´»çš„è—è¡“, å¿ƒç†æ¸¬é©—, äººæ ¼åˆ†æ, 16å‹äººæ ¼, æ–‡å­¸, å“²å­¸">
    <meta name="author" content="Life Formula Project">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ä½ çš„å¸³è™Ÿ.github.io/life-formula/">
    <meta property="og:title" content="æ—èªå ‚ç”Ÿæ´»å…¬å¼ï¼šæ¢ç´¢ä½ çš„éˆé­‚åŒ–å­¸é…æ–¹">
    <meta property="og:description" content="ç”Ÿæ´»æ˜¯ä¸€å ´å¾®å¦™çš„åŒ–å­¸å¯¦é©—ã€‚æ¸¬æ¸¬çœ‹ä½ çš„ã€Œç¾å¯¦ã€å¤¢æƒ³ã€å¹½é»˜ã€æ•æ„Ÿã€æŒ‡æ•¸æ˜¯å¤šå°‘ï¼Ÿæ‰¾å‡ºå±¬æ–¼ä½ çš„ç”Ÿæ´»å“²å­¸ã€‚">
    <meta property="og:image" content="https://ui-avatars.com/api/?name=Life+Formula&background=FDF8F5&color=5D4037&size=512">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="æ—èªå ‚ç”Ÿæ´»å…¬å¼ï¼šæ¢ç´¢ä½ çš„éˆé­‚åŒ–å­¸é…æ–¹">
    <meta property="twitter:description" content="ç¾å¯¦æ¸›å¤¢æƒ³ç­‰æ–¼ç¦½ç¸ï¼Œç¾å¯¦åŠ å¤¢æƒ³åŠ å¹½é»˜ç­‰æ–¼æ™ºæ…§ã€‚ç«‹å³é«”é©— 16 å‹ç”Ÿæ´»äººæ ¼æ¸¬é©—ã€‚">

    <style>
        :root {
            /* æº«æš–æ›¸ç±/å’–å•¡å»³ä¸»é¡Œé…è‰² */
            --bg-color: #FDF8F5;       /* æš–ç±³ç™½èƒŒæ™¯ */
            --card-bg: #FFFFFF;        /* ç´”ç™½å¡ç‰‡ */
            --text-primary: #5D4037;   /* æ·±æ —è‰²/å’–å•¡è‰²å­—é«” */
            --text-secondary: #8D7B75; /* æš–ç°æ£•è‰²å­—é«” */
            
            /* èª¿æ•´ç‚ºå¸¶æœ‰æš–èª¿çš„å¼·èª¿è‰² */
            --accent-r: #2E7D73; /* ç¾å¯¦ - å¾©å¤æ¾çŸ³ç¶  (æ¯”å†·è—æ›´æº«æ½¤) */
            --accent-d: #8E44AD; /* å¤¢æƒ³ - è‘¡è„ç´« */
            --accent-h: #F59E0B; /* å¹½é»˜ - æº«æš–ç¥ç€é‡‘ */
            --accent-s: #EC5E6D; /* æ•æ„Ÿ - çŠç‘šç´… */
            
            --success: #2E7D73;
            --warning: #F59E0B;
            --radius-lg: 24px;
            --radius-md: 16px;
            /* é™°å½±æ”¹ç‚ºæš–æ£•è‰²èª¿ */
            --shadow: 0 10px 30px -5px rgba(93, 64, 55, 0.08), 0 8px 10px -6px rgba(93, 64, 55, 0.02);
            --border: 1px solid #EFE6E1; /* å¥¶èŒ¶è‰²é‚Šæ¡† */
            
            /* é€šç”¨æš–ç°èƒŒæ™¯ (ç”¨æ–¼æŒ‰éˆ•ã€å€å¡Š) */
            --surface-warm: #FAF5F2; 
            --surface-hover: #F2E8E3;
            --element-border: #E8DED8;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            /* ä½¿ç”¨ 100dvh (Dynamic Viewport Height) è§£æ±ºæ‰‹æ©Ÿç¶²å€åˆ—é®æ“‹å•é¡Œ */
            height: 100vh;
            height: 100dvh; 
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* å®¹å™¨ */
        .app-container {
            width: 100%;
            max-width: 480px;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 24px;
        }

        /* æ¨™é¡Œå€ */
        header {
            text-align: left;
            margin-bottom: 20px;
            z-index: 10;
            flex-shrink: 0; /* é˜²æ­¢æ¨™é¡Œè¢«å£“ç¸® */
        }

        h1 {
            font-size: 24px;
            font-weight: 800;
            margin: 0;
            color: var(--text-primary);
        }

        p.subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
            font-weight: 500;
        }

        /* é é¢åˆ‡æ›æ§åˆ¶ */
        .page {
            display: none;
            flex: 1;
            flex-direction: column;
            animation: fadeIn 0.4s ease-out;
            position: relative; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; 
            padding-bottom: 20px; 
            /* ç¢ºä¿é é¢æœ¬èº«ä¸æœƒè¶…å‡ºå®¹å™¨ */
            max-height: 100%;
        }
        
        /* é‡å° Result å’Œ Review é é¢ä½¿ç”¨ Flexbox ä½ˆå±€ï¼Œè§£æ±ºåº•éƒ¨é®æ“‹å•é¡Œ */
        #page-result.page, #page-gallery.page, #page-review.page {
            display: none; /* active æ™‚æœƒè¢«è¦†è“‹ç‚º flex */
            flex-direction: column;
            height: 100%;
            overflow: hidden; /* å…§éƒ¨æ»¾å‹• */
            padding-bottom: 0;
        }
        
        #page-result.page.active, #page-gallery.page.active, #page-review.page.active {
            display: flex;
        }

        /* éš±è— Scrollbar ä½†ä¿æŒåŠŸèƒ½ */
        .page::-webkit-scrollbar, .result-scroll::-webkit-scrollbar, .gallery-list::-webkit-scrollbar {
            display: none;
        }
        .page, .result-scroll, .gallery-list {
            scrollbar-width: none;
        }

        .page.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- é¦–é  --- */
        .intro-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 32px;
            flex: 1; 
            min-height: min-content; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: var(--shadow);
            border: var(--border);
            margin-bottom: 20px;
        }

        /* Review é é¢çš„ intro-card éœ€è¦ç‰¹æ®Šè™•ç†æ»¾å‹• */
        #page-review .intro-card {
            overflow-y: auto;
            margin-bottom: 0; /* åœ¨ flex ä½ˆå±€ä¸­ä¸éœ€è¦ margin-bottom */
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            border-bottom: none;
        }

        .formula-display {
            font-family: monospace;
            background: var(--surface-warm);
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            margin-bottom: 24px;
            border: 1px solid var(--element-border);
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-start;
        }

        .formula-row {
            display: flex;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
            width: 100%;
        }
        
        .formula-badge {
            padding: 4px 8px;
            border-radius: 6px;
            margin-right: 8px;
            font-size: 12px;
            min-width: 40px;
            text-align: center;
        }

        .f-text {
            flex: 1;
        }

        /* å…è²¬è²æ˜æ¨£å¼ */
        .disclaimer {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--element-border);
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.6;
            opacity: 0.8;
            width: 100%;
        }

        /* --- æŒ‰éˆ• --- */
        .btn {
            background: var(--text-primary);
            color: #fff;
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s, background 0.2s;
            text-align: center;
            box-shadow: 0 4px 10px rgba(93, 64, 55, 0.15);
            margin-top: 12px;
        }

        .btn:active {
            transform: scale(0.98);
        }
        
        .btn:hover {
            background: #4E342E; /* Darker brown */
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--element-border);
            color: var(--text-primary);
            margin-top: 12px;
            box-shadow: none;
        }
        
        .btn-outline:hover {
            border-color: #D7CCC8;
            background: var(--surface-warm);
        }

        /* --- æ¸¬é©—é  --- */
        .progress-bar {
            height: 8px;
            background: var(--element-border);
            border-radius: 4px;
            margin-bottom: 24px;
            overflow: hidden;
            flex-shrink: 0;
        }
        .progress-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 32px 24px;
            flex: 1;
            min-height: min-content; 
            display: flex;
            flex-direction: column;
            justify-content: center; 
            position: relative;
            box-shadow: var(--shadow);
            border: var(--border);
        }

        .question-text {
            font-size: 20px;
            line-height: 1.6;
            font-weight: 700;
            margin-bottom: 32px;
            color: var(--text-primary);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .option-btn {
            background: var(--surface-warm);
            border: 1px solid var(--element-border);
            color: var(--text-primary);
            padding: 18px;
            border-radius: 12px;
            text-align: left;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer; 
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .option-btn:hover {
            background: var(--surface-hover);
            border-color: #D7CCC8;
        }

        /* Selected State */
        .option-btn.selected {
            background: #EFEBE9;
            border-color: var(--text-primary);
            box-shadow: 0 0 0 1px var(--text-primary);
        }
        
        .option-btn.selected .option-score {
            background: var(--text-primary);
            color: #fff;
        }

        .option-score {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #E8DED8; 
            color: var(--text-secondary);
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Navigation Buttons (Prev/Skip) */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 24px;
            gap: 12px;
        }

        .btn-nav {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid transparent;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-nav:hover:not(:disabled) {
            background: var(--surface-warm);
            color: var(--text-primary);
        }

        .btn-nav:disabled {
            color: #D7CCC8;
            cursor: default;
        }

        /* --- ç¢ºèªé  (Review Page) --- */
        .review-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }

        .review-item {
            aspect-ratio: 1;
            background: #fff;
            border: 1px solid var(--element-border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .review-item.answered {
            background: var(--success);
            color: #fff;
            border-color: var(--success);
        }

        .review-item.skipped {
            background: var(--surface-warm);
            color: var(--text-primary);
            border: 2px dashed var(--text-secondary);
        }
        
        .review-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        /* --- çµæœé  (Result Page) --- */
        /* ä¿®æ”¹ï¼šä½¿ç”¨ Flexbox è®“æ»¾å‹•å€èˆ‡åº•éƒ¨æŒ‰éˆ•è‡ªç„¶åˆ†å‰² */
        .result-scroll {
            flex: 1; /* è‡ªå‹•ä½”æ»¿å‰©é¤˜ç©ºé–“ */
            overflow-y: auto; /* è¶…å‡ºæ™‚é¡¯ç¤ºæ»¾å‹•æ¢ */
            padding-bottom: 24px; /* å…§å®¹åº•éƒ¨çš„å‘¼å¸ç©ºé–“ */
        }

        .result-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 24px;
            text-align: center;
            border: var(--border);
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .type-code {
            font-family: monospace;
            font-size: 14px;
            color: var(--text-secondary);
            letter-spacing: 2px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .type-title {
            font-size: 28px;
            font-weight: 800;
            margin: 0 0 16px 0;
            color: var(--text-primary);
        }

        /* é›·é”åœ–å®¹å™¨ */
        .radar-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 24px auto;
            position: relative;
        }
        
        .radar-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 10px rgba(93, 64, 55, 0.1));
        }

        .lin-quote {
            background: var(--surface-warm);
            border-left: 4px solid var(--accent-h);
            padding: 20px;
            text-align: left;
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-primary);
            border-radius: 0 12px 12px 0;
            margin-bottom: 24px;
            font-style: italic;
            font-weight: 500;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-item {
            background: var(--surface-warm);
            padding: 12px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            border: 1px solid var(--element-border);
        }

        .stat-label { font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; font-weight: 600;}
        .stat-value { font-size: 18px; font-weight: bold; }
        .stat-bar { height: 6px; width: 100%; background: var(--element-border); border-radius: 3px; margin-top: 8px; overflow: hidden; }
        .stat-fill { height: 100%; border-radius: 3px; }

        .desc-box {
            text-align: left;
            font-size: 16px;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        /* ä¿®æ”¹ï¼šAction Bar ä¸å†æ˜¯ Absoluteï¼Œè€Œæ˜¯ Flex Item */
        .action-bar {
            position: relative; /* å›æ­¸è‡ªç„¶æ–‡æª”æµ */
            width: 100%;
            padding: 20px 0; /* å·¦å³ä¸éœ€è¦ paddingï¼Œå› ç‚ºå¤–å±¤ container å·²ç¶“æœ‰ padding */
            background: transparent; 
            display: flex;
            gap: 12px;
            border-top: 1px solid var(--element-border);
            flex-shrink: 0; /* é˜²æ­¢æŒ‰éˆ•è¢«å£“ç¸® */
            margin-top: auto; /* ç¢ºä¿æ¨åˆ°åº•éƒ¨ */
        }

        /* --- å…¨åœ–é‘‘é  (Gallery) --- */
        .gallery-list {
            flex: 1; /* ä½”æ»¿ç©ºé–“ */
            overflow-y: auto;
            padding-bottom: 24px;
        }

        .gallery-item {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--element-border);
            cursor: pointer;
            transition: transform 0.1s;
        }
        .gallery-item:active { transform: scale(0.99); }
        
        .g-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .g-title { font-weight: 700; font-size: 17px; color: var(--text-primary); }
        .g-badges { display: flex; gap: 4px; }
        
        /* è¿·ä½ æ¨™ç±¤ */
        .g-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            border-width: 1px;
            border-style: solid;
        }
        
        /* å¯¦å¿ƒä»£è¡¨é«˜åˆ†ï¼Œç©ºå¿ƒä»£è¡¨ä½åˆ† */
        .g-badge.high { color: #fff; }
        .g-badge.low { background: transparent; }

        .g-desc { font-size: 13px; color: var(--text-secondary); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-top: 6px;}

        /* Loading */
        .loader {
            border: 4px solid var(--element-border);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border-left-color: var(--accent-r);
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* å¯¦å¿ƒæ–‡å­—æ¨™ç±¤ */
        .txt-r { color: var(--accent-r); }
        .txt-d { color: var(--accent-d); }
        .txt-h { color: var(--accent-h); }
        .txt-s { color: var(--accent-s); }

    </style>
</head>
<body>

    <div class="app-container">
        <!-- Header -->
        <header>
            <h1>Life Formula</h1>
            <p class="subtitle">æ—èªå ‚ç”Ÿæ´»å…¬å¼ï¼šäººæ ¼åŒ–å­¸å®¤</p>
        </header>

        <!-- 1. Start Page -->
        <div id="page-start" class="page active">
            <div class="intro-card">
                <div class="formula-display">
                    <div class="formula-row">
                        <span class="formula-badge" style="background:var(--accent-r); color:#fff">R</span>
                        <span class="f-text txt-r">Reality ç¾å¯¦</span>
                    </div>
                    <div class="formula-row">+</div>
                    <div class="formula-row">
                        <span class="formula-badge" style="background:var(--accent-d); color:#fff">D</span>
                        <span class="f-text txt-d">Dreams å¤¢æƒ³</span>
                    </div>
                    <div class="formula-row">+</div>
                    <div class="formula-row">
                        <span class="formula-badge" style="background:var(--accent-h); color:#fff">H</span>
                        <span class="f-text txt-h">Humor å¹½é»˜</span>
                    </div>
                    <div class="formula-row">+</div>
                    <div class="formula-row">
                        <span class="formula-badge" style="background:var(--accent-s); color:#fff">S</span>
                        <span class="f-text txt-s">Sensibility æ•æ„Ÿ</span>
                    </div>
                    <div class="formula-row" style="margin-top:8px; border-top: 1px dashed #D7CCC8; padding-top:8px;">
                        <span class="f-text" style="text-align:right; font-size:16px;">= Your Type ?</span>
                    </div>
                </div>
                
                <p style="color: var(--text-secondary); line-height: 1.6; text-align: center; font-size: 15px; margin-bottom: 32px;">
                    ã€Œç¾å¯¦æ¸›å¤¢æƒ³ç­‰æ–¼ç¦½ç¸ï¼Œç¾å¯¦åŠ å¤¢æƒ³åŠ å¹½é»˜ç­‰æ–¼æ™ºæ…§ã€‚ã€<br><br>
                    é€éæ—èªå ‚å…ˆç”Ÿçš„å…¬å¼ï¼Œæ‰¾å‡ºä½ éˆé­‚çš„åŒ–å­¸é…æ–¹ï¼Œçœ‹çœ‹ä½ æ˜¯å“ªä¸€ç¨®ç”Ÿæ´»å®¶ã€‚
                </p>
                
                <button class="btn" onclick="startQuiz()">é–‹å§‹åˆ†æ</button>

                <!-- æ–°å¢å…è²¬è²æ˜ -->
                <div class="disclaimer">
                    âš ï¸ è²æ˜ï¼šæœ¬æ¸¬é©—éˆæ„Ÿå–è‡ªæ—èªå ‚ã€Šç”Ÿæ´»çš„è—è¡“ã€‹ï¼Œ<br>åƒ…ä¾›æ¨å»£æ–‡å­¸èˆ‡ç”Ÿæ´»å“²å­¸ä¹‹ç”¨ï¼Œä¸¦éå°ˆæ¥­å¿ƒç†è©•ä¼°å·¥å…·ï¼Œ<br>çµæœåƒ…ä¾›å¨›æ¨‚èˆ‡åƒè€ƒã€‚
                </div>
            </div>
        </div>

        <!-- 2. Quiz Page -->
        <div id="page-quiz" class="page">
            <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
            
            <div class="question-card">
                <div id="q-content">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
                        QUESTION <span id="q-number">1</span> / <span id="q-total">16</span>
                    </div>
                    <div id="q-text" class="question-text">é¡Œç›®è¼‰å…¥ä¸­...</div>
                </div>
                
                <div class="options-grid" id="options-container">
                    <button class="option-btn" onclick="answer(1)" data-val="1">
                        éå¸¸ä¸ç¬¦åˆ <span class="option-score">1</span>
                    </button>
                    <button class="option-btn" onclick="answer(2)" data-val="2">
                        æœ‰é»ä¸ç¬¦åˆ <span class="option-score">2</span>
                    </button>
                    <button class="option-btn" onclick="answer(3)" data-val="3">
                        æœ‰é»ç¬¦åˆ <span class="option-score">3</span>
                    </button>
                    <button class="option-btn" onclick="answer(4)" data-val="4">
                        éå¸¸ç¬¦åˆ <span class="option-score">4</span>
                    </button>
                </div>

                <div class="nav-buttons">
                    <button class="btn-nav" id="btn-prev" onclick="prevQuestion()">â† ä¸Šä¸€é¡Œ</button>
                    <button class="btn-nav" id="btn-skip" onclick="skipQuestion()">è·³éæ­¤é¡Œ â†’</button>
                </div>
            </div>
        </div>

        <!-- 3. Review Page -->
        <div id="page-review" class="page">
            <div class="intro-card" style="flex: 1; overflow: hidden; margin-bottom: 0; border-bottom: none; border-radius: 24px 24px 0 0; padding-bottom: 0;">
                <div style="overflow-y: auto; width: 100%; padding-bottom: 20px;">
                    <h2 style="font-size: 24px; margin-bottom: 12px;">ç­”é¡Œç¢ºèª</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 24px; font-size: 14px;">
                        è«‹ç¢ºèªæ‚¨çš„ç­”é¡Œç‹€æ³ã€‚é»æ“Šé¡Œè™Ÿå¯è¿”å›ä¿®æ”¹ã€‚<br>
                        <span style="color:var(--success)">â— å·²ç­”</span> / <span style="color:var(--text-primary)">â—‹ æœªç­”</span>
                    </p>

                    <div id="review-grid" class="review-grid">
                        <!-- JS Injected -->
                    </div>

                    <div id="review-alert" style="color: #E53935; font-size: 13px; margin-bottom: 16px; display: none;">
                        é‚„æœ‰é¡Œç›®æœªå®Œæˆï¼Œè«‹å…ˆå®Œæˆæ‰€æœ‰é¡Œç›®ï¼
                    </div>
                </div>
            </div>
            
            <div class="action-bar" style="background: var(--card-bg); border-top: 1px solid var(--border); padding: 20px 24px;">
                <button class="btn" style="margin: 0; width: 60%;" onclick="calculateAndShowResult()">ç¢ºèªæäº¤</button>
                <button class="btn btn-outline" style="margin: 0; width: 40%;" onclick="backToQuizFromReview()">è¿”å›</button>
            </div>
        </div>

        <!-- 4. Loading Page -->
        <div id="page-loading" class="page" style="justify-content: center; align-items: center;">
            <div class="loader"></div>
            <p style="margin-top: 24px; color: var(--text-secondary); font-weight: 500;">æ­£åœ¨èª¿é…åŒ–å­¸å…¬å¼...</p>
        </div>

        <!-- 5. Result Page -->
        <div id="page-result" class="page">
            <div class="result-scroll">
                <div class="result-card">
                    <div id="result-code" class="type-code">CODE: ----</div>
                    <h2 id="result-title" class="type-title">è¼‰å…¥ä¸­...</h2>
                    
                    <!-- SVG Radar Chart -->
                    <div class="radar-container">
                        <svg class="radar-svg" viewBox="0 0 100 100">
                            <!-- Background Grid -->
                            <polygon points="50,10 90,50 50,90 10,50" fill="none" stroke="#E8DED8" stroke-width="1"/>
                            <polygon points="50,30 70,50 50,70 30,50" fill="none" stroke="#E8DED8" stroke-width="1"/>
                            <line x1="50" y1="10" x2="50" y2="90" stroke="#E8DED8" stroke-width="1"/>
                            <line x1="10" y1="50" x2="90" y2="50" stroke="#E8DED8" stroke-width="1"/>
                            
                            <!-- Labels -->
                            <text x="50" y="8" fill="#2E7D73" font-size="6" font-weight="bold" text-anchor="middle">R ç¾å¯¦</text>
                            <text x="96" y="52" fill="#8E44AD" font-size="6" font-weight="bold" text-anchor="middle">D å¤¢æƒ³</text>
                            <text x="50" y="98" fill="#F59E0B" font-size="6" font-weight="bold" text-anchor="middle">H å¹½é»˜</text>
                            <text x="4" y="52" fill="#EC5E6D" font-size="6" font-weight="bold" text-anchor="middle">S æ•æ„Ÿ</text>

                            <!-- The Data Polygon -->
                            <polygon id="radar-poly" points="50,50 50,50 50,50 50,50" fill="rgba(46, 125, 115, 0.2)" stroke="#2E7D73" stroke-width="2"/>
                        </svg>
                    </div>

                    <div id="lin-quote" class="lin-quote">
                        "..."
                    </div>

                    <div id="desc-box" class="desc-box">
                        åˆ†æå…§å®¹...
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Reality ç¾å¯¦</span>
                        <span id="score-r" class="stat-value" style="color: var(--accent-r);">0.0</span>
                        <div class="stat-bar"><div id="bar-r" class="stat-fill" style="background: var(--accent-r); width: 0%"></div></div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Dreams å¤¢æƒ³</span>
                        <span id="score-d" class="stat-value" style="color: var(--accent-d);">0.0</span>
                        <div class="stat-bar"><div id="bar-d" class="stat-fill" style="background: var(--accent-d); width: 0%"></div></div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Humor å¹½é»˜</span>
                        <span id="score-h" class="stat-value" style="color: var(--accent-h);">0.0</span>
                        <div class="stat-bar"><div id="bar-h" class="stat-fill" style="background: var(--accent-h); width: 0%"></div></div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Sensibility æ•æ„Ÿ</span>
                        <span id="score-s" class="stat-value" style="color: var(--accent-s);">0.0</span>
                        <div class="stat-bar"><div id="bar-s" class="stat-fill" style="background: var(--accent-s); width: 0%"></div></div>
                    </div>
                </div>

                <!-- å›é¥‹å•å·é€£çµå€å¡Š -->
                <div style="margin-bottom: 24px; text-align: center;">
                    <a href="https://forms.gle/SzLNo7wfnLddbaxe9" target="_blank" class="btn btn-outline" style="text-decoration: none; display: flex; align-items: center; justify-content: center; margin-top: 0; background: var(--surface-warm);">
                        ğŸ“ å¡«å¯«å›é¥‹å•å·
                    </a>
                    <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">æ‚¨çš„æ„è¦‹èƒ½å¹«åŠ©æˆ‘å€‘åšå¾—æ›´å¥½ï¼</p>
                </div>
            </div>

            <div class="action-bar">
                <button class="btn btn-outline" style="margin:0; width: 40%;" onclick="showGallery()">æŸ¥çœ‹å…¨åœ–é‘‘</button>
                <button class="btn" style="width: 60%; margin:0;" onclick="location.reload()">é‡æ–°æ¸¬é©—</button>
            </div>
        </div>

        <!-- 6. Gallery Page -->
        <div id="page-gallery" class="page">
            <div style="flex:1; overflow-y:auto; padding-bottom:80px;">
                <h2 style="margin-bottom:16px;">å…¨é¡å‹åœ–é‘‘ (16å‹)</h2>
                <div id="gallery-container" class="gallery-list">
                    <!-- Items injected by JS -->
                </div>
            </div>
            <div class="action-bar">
                <button class="btn" onclick="backToResult()">è¿”å›çµæœ</button>
            </div>
        </div>

    </div>

    <script>
        // --- 1. Data: Questions ---
        const rawQuestions = [
            // R: ç¾å¯¦æ„Ÿ
            { type: 'R', text: "æ¯”èµ·æŠ½è±¡çš„ç†è«–æˆ–é¡˜æ™¯ï¼Œæˆ‘æ›´åœ¨æ„é€™ä»¶äº‹èƒ½ä¸èƒ½è³ºéŒ¢ï¼Œæˆ–å°ç”Ÿæ´»æœ‰æ²’æœ‰å¯¦éš›å¹«åŠ©ã€‚" },
            { type: 'R', text: "é‡åˆ°å•é¡Œæ™‚ï¼Œæˆ‘ç¿’æ…£å…ˆè€ƒæ…®é¢¨éšªå’ŒåŸ·è¡Œé›£åº¦ï¼Œè€Œä¸æ˜¯å…ˆè«‡è«–ç†æƒ³ç‹€æ³ã€‚" },
            { type: 'R', text: "æˆ‘æ“…é•·è™•ç†ç”Ÿæ´»ç‘£äº‹ï¼ˆå¦‚è¨˜å¸³ã€å®¶å‹™ã€è¡Œç¨‹å®‰æ’ï¼‰ï¼Œä¸¦è¦ºå¾—é€™èƒ½å¸¶ä¾†è¸å¯¦æ„Ÿã€‚" },
            { type: 'R', text: "æˆ‘èªç‚ºã€è­˜æ™‚å‹™è€…ç‚ºä¿Šå‚‘ã€ï¼Œåœ¨ä¸å¯æŠ—åŠ›é¢å‰ï¼Œå¦¥å”å¾€å¾€æ¯”å …æŒæ›´æœ‰æ™ºæ…§ã€‚" },
            
            // D: å¤¢æƒ³
            { type: 'D', text: "æˆ‘å¸¸å°ç¾ç‹€æ„Ÿåˆ°ä¸æ»¿ï¼Œç¸½è¦ºå¾—ç¤¾æœƒåˆ¶åº¦æˆ–å‘¨é­ç’°å¢ƒæ‡‰è©²è¦å¾¹åº•æ”¹è®Šã€‚" },
            { type: 'D', text: "æˆ‘å¾ˆå®¹æ˜“è¢«å®å¤§çš„ä½¿å‘½ã€ç†±è¡€çš„å£è™Ÿæˆ–å®Œç¾çš„çƒæ‰˜é‚¦é¡˜æ™¯æ‰€æ„Ÿå‹•ã€‚" },
            { type: 'D', text: "ç‚ºäº†è¿½æ±‚å¿ƒä¸­çš„ç†æƒ³ï¼Œå³ä½¿è¦ä»˜å‡ºå·¨å¤§çš„ä»£åƒ¹æˆ–èµ°å½è·¯ï¼Œæˆ‘ä¹Ÿåœ¨æ‰€ä¸æƒœã€‚" },
            { type: 'D', text: "æˆ‘ç¶“å¸¸æƒ³åƒå¦‚æœæ­·å²èµ°å‘ä¸åŒï¼Œæˆ–æ˜¯å¦‚æœæœ‰ä¸€ç¨®æ–°çš„ç§‘æŠ€ï¼Œä¸–ç•Œæœƒè®Šå¾—å¤šéº¼ç¾å¥½ã€‚" },

            // H: å¹½é»˜
            { type: 'H', text: "ç•¶æˆ‘çŠ¯è ¢æˆ–è·Œå€’æ™‚ï¼Œæˆ‘ç¬¬ä¸€åæ‡‰é€šå¸¸æ˜¯è¦ºå¾—è‡ªå·±å¾ˆå¥½ç¬‘ï¼Œè€Œä¸æ˜¯æ„Ÿåˆ°ç¾æ†¤ã€‚" },
            { type: 'H', text: "æˆ‘èªç‚ºäººç”Ÿæœ¬ä¾†å°±å¸¶é»è’è¬¬ï¼Œå¤ªéæ­£ç¶“åš´è‚…åœ°çœ‹å¾…ä¸€åˆ‡æ˜¯å¾ˆç´¯äººçš„ã€‚" },
            { type: 'H', text: "åœ¨ç·Šå¼µæˆ–æ‚²å‚·çš„æ°£æ°›ä¸­ï¼Œæˆ‘ä»èƒ½çœ‹å‡ºäº‹æƒ…æ»‘ç¨½æˆ–è«·åˆºçš„ä¸€é¢ï¼Œä¸¦è®“å¿ƒæƒ…æ”¾é¬†ã€‚" },
            { type: 'H', text: "æˆ‘ä¸å–œæ­¡é‚£ç¨®é€™è¼©å­é€£ä¸€æ¬¡ã€å‚»äº‹ã€éƒ½æ²’åšéçš„æ­£ç¶“äººï¼Œå®Œç¾å¾€å¾€æ„å‘³è‘—ç„¡è¶£ã€‚" },

            // S: æ•æ„Ÿ
            { type: 'S', text: "çœ‹åˆ°ç¾éº—çš„æ™¯è‰²ã€è—è¡“ä½œå“æˆ–æ„Ÿäººçš„é›»å½±ï¼Œæˆ‘å¸¸æœƒæ·±å—è§¸å‹•ç”šè‡³è½æ·šã€‚" },
            { type: 'S', text: "æˆ‘å°ä»–äººçš„æƒ…ç·’è®ŠåŒ–å¾ˆæ•æ„Ÿï¼Œå¸¸èƒ½å¯Ÿè¦ºå°æ–¹æ²’èªªå‡ºå£çš„å¿ƒäº‹ã€‚" },
            { type: 'S', text: "æˆ‘èªç‚ºé‚è¼¯æ­£ç¢ºå›ºç„¶é‡è¦ï¼Œä½†ã€Œç¾çš„æ„Ÿå—ã€å’Œã€Œäººæƒ…å‘³ã€æ›´ä¸å¯æˆ–ç¼ºã€‚" },
            { type: 'S', text: "è®€åˆ°ä¸€é¦–å¥½è©©æˆ–è½åˆ°ä¸€æ®µå‹•äººçš„æ—‹å¾‹ï¼Œæœƒè®“æˆ‘æ•´å¤©çš„å¿ƒæƒ…éƒ½æŸ“ä¸Šé‚£ç¨®è‰²å½©ã€‚" }
        ];

        let questions = []; 
        let userAnswers = []; // Store user answers: [1, 3, 2, null, 4...]

        // --- 2. Data: 16 Types ---
        const archetypes = {
            "RDHS": { title: "å…¨èƒ½æ–‡è—å¾©èˆˆäºº", quote: "ã€Œæˆ‘å€‘æœªå˜—ä¸å¯èªªï¼Œè˜‡æ±å¡æ˜¯å€‹ç§‰æ€§é›£æ”¹çš„æ¨‚å¤©æ´¾â€¦â€¦æ˜¯é‡€é…’çš„å¯¦é©—è€…ï¼Œæ˜¯å·¥ç¨‹å¸«ã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€Šè˜‡æ±å¡å‚³ã€‹", desc: "æ¥µç‚ºç½•è¦‹çš„å®Œç¾å¹³è¡¡ã€‚ä½ æœ‰å•†äººçš„ç²¾æ˜ã€é©å‘½å®¶çš„ç†æƒ³ã€å–œåŠ‡æ¼”å“¡çš„è±é”ï¼Œé‚„æœ‰è©©äººçš„ç´°è†©ã€‚" },
            "RDHs": { title: "å†·éœçš„è®Šé©è€…", quote: "ã€Œæˆ‘ä¸åšå¤¢ï¼Œå¸Œæœ›ä¸­åœ‹æ”¿æ²»äººæ‰è¼©å‡ºï¼Œåªå¸Œæœ›æœ‰ä¸€ä½å·®å¼·äººæ„ï¼Œèªªè©±é å¾—ä½çš„å®˜åƒšã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€ˆä¸­åœ‹ä¹‹å¤¢ã€‰", desc: "ä½ æœ‰æ”¹è®Šä¸–ç•Œçš„æ‰‹æ®µèˆ‡é‡å¿ƒï¼Œä¹Ÿæœ‰å¹½é»˜æ„Ÿä¾†åŒ–è§£å£“åŠ›ã€‚å”¯ç¨ç¼ºä¹ä¸€é»æ•æ„Ÿåº¦ã€‚" },
            "RDhS": { title: "æ‚²æƒ…çš„è‹¦è¡Œåƒ§", quote: "ã€Œç²¾ç¥çš„æ­¡æ¨‚å’Œèº«é«”çš„æ­¡æ¨‚æ˜¯ä¸å¯åˆ†é›¢çš„ã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€Šç”Ÿæ´»çš„è—è¡“ã€‹", desc: "ä½ çœ‹æ¸…ç¾å¯¦åˆæ‡·æŠ±ç†æƒ³ï¼Œä¸”é«˜æ•æ„Ÿè®“ä½ å°ä¸–é–“ç—›è‹¦æ„ŸåŒèº«å—ã€‚å› ç¼ºä¹å¹½é»˜æ„Ÿï¼Œæ´»å¾—æ²‰é‡ã€‚" },
            "RDhs": { title: "ç„¦æ…®çš„é€²å–è€…", quote: "ã€Œäººé¡ç‚ºç”Ÿæ´»å¦‚æ­¤åŒ†å¿™ï¼Œé€™éš»é‡ç¸ä¸€å®šæœƒå°é€™å€‹äººé¡ç¤¾æœƒç™¼ç”Ÿå¾ˆå¤§çš„ç–‘æƒ‘å’Œé©šå¥‡ã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€Šç”Ÿæ´»çš„è—è¡“ã€‹ã€‚", desc: "ç¾å¯¦èˆ‡å¤¢æƒ³æ¿€çƒˆæ‹”æ²³ã€‚ä½ æ¥µåº¦æ¸´æœ›æˆåŠŸï¼ŒåŸ·è¡ŒåŠ›å¼·ï¼Œä½†ç¼ºä¹å¹½é»˜èˆ‡æ•æ„Ÿçš„æ½¤æ»‘ã€‚" },
            "RdHS": { title: "äººé–“ç…™ç«å¤§å¸«", quote: "ã€Œæ‰€æ€•çš„å°±æ˜¯ä»–å°‡é‡è¦–ç…§ç‰‡ï¼Œè€Œå¿˜å»äº†èŒ¶å‘³ã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€ˆæ—…è¡Œçš„äº«å—ã€‰", desc: "æ”¾æ£„äº†ç©ºæ³›çš„ç†æƒ³ï¼Œå°ˆæ³¨æ–¼ã€Œæ´»åœ¨ç•¶ä¸‹ã€ã€‚æ¥µé«˜çš„ç”Ÿæ´»å“å‘³èˆ‡å¹½é»˜æ„Ÿï¼Œæ˜¯æœ€æ‡‚éæ—¥å­çš„äººã€‚" },
            "RdHs": { title: "ç²¾æ˜çš„ç¾å¯¦ä¸»ç¾©è€…", quote: "ã€ŒéŒ¢å¾ˆé‡è¦ï¼Œé€™è©±é‚„å¾…æˆ‘èªªå—ï¼Ÿã€ï¼Œæ—èªå ‚â€”ã€ˆè«–åˆ©ã€‰", desc: "å‹™å¯¦ã€ä¸ä¿¡ç©ºè«‡ã€‚ä½ çš„å¹½é»˜æ„Ÿé€šå¸¸æ˜¯ç”¨ä¾†å˜²ç¬‘é‚£äº›ä¸åˆ‡å¯¦éš›çš„äººã€‚æƒ…ç·’ç©©å®šï¼Œç¶­è­·ç¾ç‹€çš„é«˜æ‰‹ã€‚" },
            "RdhS": { title: "å®ˆèˆŠçš„å·¥åŒ ", quote: "ã€Œæ—…è¡Œåœ¨å¾å‰æ˜¯è¡Œæ¨‚ä¹‹ä¸€ï¼Œä½†ç¾åœ¨å·²è®Šæˆä¸€ç¨®å¯¦æ¥­â€¦â€¦æ—…è¡Œåˆ°äº†ç¾ä»£ï¼Œä¼¼ä¹å·²æ˜¯ä¸€ç¨®æ²’è½çš„è—è¡“ã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€ˆæ—…è¡Œçš„äº«å—ã€‰", desc: "å®‰åˆ†å®ˆå·±ï¼Œå°ˆæ³¨ç•¶ä¸‹ã€‚ä¸ç™½æ—¥å¤¢ä¹Ÿä¸é–‹ç©ç¬‘ï¼Œä½†å°ç´°ç¯€æœ‰é©šäººçš„æ•æ„Ÿåº¦ã€‚" },
            "Rdhs": { title: "ç„¡æƒ…çš„é‹ç®—æ©Ÿ", quote: "ã€Œå¯§å¯æˆ‘ä¾†å¼„è¨ˆç®—æ©Ÿï¼Œä¸å¯è®“è¨ˆç®—æ©Ÿè¨ˆç®—æˆ‘ã€‚ï¼ã€â€”â€”æ—èªå ‚ï¼Œã€ˆè«‡è¨ˆç®—æ©Ÿã€‰", desc: "æ‘’æ£„äº†å¤¢æƒ³ã€å¹½é»˜å’Œæƒ…æ„Ÿï¼Œåªå‰©ä¸‹ç´”ç²¹çš„ç”Ÿå­˜èˆ‡é‚è¼¯ã€‚åƒæ©Ÿå™¨ä¸€æ¨£é«˜æ•ˆã€‚" },
            "rDHS": { title: "å¤±æ§çš„å¤¢éŠè€…", quote: "ã€Œå¦‚æœäººé¡çš„å¿ƒæ™ºæ˜¯é«˜è²´çš„ï¼Œé‚£éº¼æˆ‘å€‘å°‡è®Šæˆå®Œå…¨ç†æ€§çš„å‹•ç‰©ï¼Œæ²’æœ‰ç½ªæƒ¡ï¼Œæ²’æœ‰å¼±é»ï¼Œä¹Ÿæ²’æœ‰éŒ¯èª¤çš„è¡Œç‚ºï¼å¦‚æœçœŸæ˜¯é€™æ¨£çš„è©±ï¼Œé€™ä¸–ç•Œå°‡è®Šæˆä¸€å€‹å¤šéº¼ä¹å‘³çš„ä¸–ç•Œï¼ã€", desc: "é™¤äº†ä¸é¡§ç¾å¯¦ï¼Œå…¶ä»–æ•¸å€¼éƒ½çˆ†è¡¨ã€‚æ‰è¯æ´‹æº¢ï¼Œå……æ»¿å¥‡æ€å¦™æƒ³ï¼Œå€‹æ€§ç˜‹ç™²å¯æ„›ã€‚" },
            "rDHs": { title: "å¿«æ¨‚çš„ç©ºæƒ³å®¶", quote: "ã€Œç§‘å­¸å®¶ç„¡æ³•å‘Šè¨´æˆ‘å€‘ä¸€åˆ‡äº‹æƒ…ï¼Œç„¡æ³•å‘Šè¨´æˆ‘è¦çš„äº‹æƒ…ï¼Œå°±æ˜¯é‚£äº›è£½é€™å¿«æ¨‚çš„äº‹æƒ…ï¼Œæ–¼æ˜¯æˆ‘ä¸å¾—ä¸å»è«‹æ•™bon sens é€™ä¸€å€‹åå…«ä¸–ç´€çš„å­—æ˜¯å€¼å¾—å¾©èˆˆçš„ã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€Šæˆ‘çš„ä¿¡ä»°ã€‹", desc: "ä½ æœ‰å¾ˆå¤šç†è«–ï¼Œèªªèµ·ä¾†é ­é ­æ˜¯é“ä¸”é¢¨è¶£ï¼Œä½†å¾æœªä»˜è«¸è¡Œå‹•ã€‚ä¸æ•æ„Ÿæ‰€ä»¥ä¸æ€•è¢«æ‰“è‡‰ã€‚" },
            "rDhS": { title: "æ†‚é¬±çš„æµªæ¼«é¨å£«", quote: "ã€Œä¸€å€‹äººé›£é“ä¸è©²æœ‰å—åˆ°æ·±æ·±æ„Ÿå‹•è€Œæµæ·šçš„æ™‚å€™ï¼Ÿã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€ˆçœ‹é›»å½±æµæ·šã€‰", desc: "ä½ æ˜¯é‚£ç¨®æŠŠç†æƒ³ç•¶çœŸã€ä¹ŸæŠŠæ—¥å­çœ‹å¾—å¤ªèªçœŸçš„äººã€‚ç¾å¯¦ä¸€å‘æ‰‹ç³™ï¼Œç¢°ä¸€ä¸‹å°±ç–¼ï¼›ååä½ åˆä¸å¸¸å€Ÿå¹½é»˜é€™æŠŠå°å‚˜ï¼Œæ›¿è‡ªå·±é®äº›é¢¨é›¨ã€‚" },
            "rDhs": { title: "ç‹‚ç†±çš„ä¿¡å¾’", quote: "ã€Œå½¢å¼ä¹Ÿåªæ˜¯ä¸€ç¨®å·¥å…·ï¼Œæ˜¯å¦æœ‰åƒ¹å€¼åœ¨æ–¼è‡ªå·±èƒ½å¦èˆ‡å®—æ•™å»ºç«‹å‹èª¼çš„é—œä¿‚ã€‚ã€â€”â€”ä¿¡ä»°ä¹‹æ—…", desc: "æœ‰æ™‚ä»–çš„å¹½é»˜æ¯”è¼ƒåƒç›´è¦ºåæ‡‰ï¼Œæœªå¿…ç¸½è¨˜å¾—å›é ­ç…§ä¸€ç…§è‡ªå·±ï¼›åŒç†å¿ƒä¹Ÿä¸æ˜¯ä»–æœ€æ“…é•·çš„èªè¨€ã€‚æ–¼æ˜¯ä»–ä¸€æ—¦èªå®šæŸå€‹çœŸç†ï¼Œå°±å®¹æ˜“èµ°å¾—å¤ªèªçœŸã€å¤ªç”¨åŠ›ã€‚" },
            "rdHS": { title: "é€šé€çš„éš±å£«", quote: "ã€Œå¤§è‡ªç„¶æœ¬èº«æ°¸é æ˜¯ä¸€å€‹ç™‚é¤Šé™¢ã€‚å®ƒå³ä½¿ä¸èƒ½æ²»ç™’åˆ¥çš„ç–¾ç—…ï¼Œä½†è‡³å°‘èƒ½æ²»ç™’äººé¡çš„è‡ªå¤§ç‹‚ã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€Šç”Ÿæ´»çš„è—è¡“ã€‹", desc: "æ—¢ä¸çˆ­åå¥ªåˆ©ï¼Œä¹Ÿä¸ç‚ºäº”æ–—ç±³æŠ˜è…°ã€‚è°æ˜èˆ‡å¯©ç¾éƒ½åœ¨èº«ä¸Šï¼Œåªæ˜¯æ›´å‚¾å‘æŠŠå®ƒå€‘æ‹¿å»ç…§çœ‹å…§å¿ƒï¼Œè€Œä¸æ˜¯æ‹¿å»æ›æŒè²ã€‚" },
            "rdHs": { title: "å¿«æ¨‚çš„è™›ç„¡ä¸»ç¾©è€…", quote: "ã€Œè§€çœ‹æ™¯ç‰©å’Œè§€çœ‹è™›ç„¡ï¼Œæœ‰æ¥µå¤§çš„å€åˆ¥ã€‚æœ‰è¨±å¤šç‰¹å»è§€çœ‹æ™¯ç‰©çš„ï¼Œå…¶å¯¦ä¸¦æ²’æœ‰çœ‹åˆ°ç”šéº¼æ™¯ç‰©ï¼Œä½†æœ‰è¨±å¤šå»è§€çœ‹è™›ç„¡çš„ï¼Œå€’åè€Œèƒ½çœ‹åˆ°è¨±å¤šäº‹ç‰©ã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€ˆæ—…è¡Œçš„äº«å—ã€‰", desc: "ä¸åœ¨ä¹ç‰©è³ªï¼Œå¿—å‘ä¹Ÿä¸æ„›å¯«æˆå¤§å­—å ±ã€‚è‹¥èªªæœ‰ä»€éº¼æ­¦å™¨ï¼Œå°±æ˜¯æŠŠå¹½é»˜â€”â€”æŠŠäººç”Ÿçœ‹æˆä¸€é½£å–œåŠ‡ï¼Œç¬‘ä¸€ç¬‘ï¼Œå¥½è®“è‡ªå·±ä¸è¢«ä¸–ç•Œçš„åš´è‚…å£“æ‰ã€‚" },
            "rdhS": { title: "è¿·é€”çš„ç¾”ç¾Š", quote: "ã€Œæˆ‘å€‘å¹¼æ™‚çš„é‚£äº›å¤¢æƒ³ä¸æ˜¯æ²’æœ‰å¯¦ç¾æ€§çš„ã€‚é€™äº›å¤¢æƒ³å¸¸å’Œæˆ‘å€‘çµ‚èº«å…±å­˜è‘—ã€‚ã€â€”â€”æ—èªå ‚ï¼Œã€Šç”Ÿæ´»çš„è—è¡“ã€‹ã€‚", desc: "å°ä¸–ç•Œå¾ˆæ•æ„Ÿï¼Œå®¹æ˜“è¢«ç´°å°çš„åˆºæ‰åˆ°ï¼›åªæ˜¯æ”¹è®Šç¾ç‹€é€™ä»¶äº‹ï¼Œä»–æœªå¿…æœ‰è¶³å¤ çš„åŠ›æ°£æˆ–å‹•åŠ›ã€‚è‹¥åååˆå¿˜äº†ç”¨å¹½é»˜æ›¿è‡ªå·±é¬†ç¶ï¼Œä¾¿åªå¥½æŠŠå—å‚·é»˜é»˜æ”¶é€²å£è¢‹è£¡ã€‚" },
            "rdhs": { title: "ä¸€å¼µç™½ç´™", quote: "ã€Œäººå¿…æœ‰ç—´ï¼Œè€Œå¾Œæœ‰æˆã€‚ã€â€”â€”æ—èªå ‚", desc: "ä½ ä¹Ÿè¨±æ­£èµ°åœ¨ä¸€æ®µè¿·éœ§è£¡ï¼›åˆæˆ–è€…ï¼Œä½ åªæ˜¯æ›´æ‡‚å¾—æŠŠç”Ÿæ´»éå¾—ç°¡å–®ã€‚" }
        };

        // --- 3. Logic ---
        let currentQIndex = 0;
        let userResultCode = "";
        let isTransitioning = false; 

        // Shuffle Helper
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function startQuiz() {
            // Init state
            currentQIndex = 0;
            userAnswers = new Array(rawQuestions.length).fill(null);
            isTransitioning = false;
            
            // Randomize
            questions = shuffle([...rawQuestions]); 
            
            switchPage('page-quiz');
            renderQuestion();
        }

        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function renderQuestion() {
            if (currentQIndex >= questions.length) {
                showReviewPage();
                return;
            }

            const q = questions[currentQIndex];
            
            // UI Text
            document.getElementById('q-text').innerText = q.text;
            document.getElementById('q-number').innerText = currentQIndex + 1;
            document.getElementById('q-total').innerText = questions.length;
            
            // Progress Bar
            const pct = (currentQIndex / questions.length) * 100;
            document.getElementById('progress-fill').style.width = `${pct}%`;

            // Reset Options Selection
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
                const val = parseInt(btn.getAttribute('data-val'));
                // Highlight if answered
                if (userAnswers[currentQIndex] === val) {
                    btn.classList.add('selected');
                }
            });

            // Nav Buttons State
            document.getElementById('btn-prev').disabled = (currentQIndex === 0);
            document.getElementById('btn-skip').innerText = (currentQIndex === questions.length - 1) ? "å®Œæˆç¢ºèª â†’" : "è·³éæ­¤é¡Œ â†’";
        }

        function answer(value) {
            if (isTransitioning) return;
            isTransitioning = true;

            // Save answer
            userAnswers[currentQIndex] = value;

            // Highlight selected immediately for feedback
            document.querySelectorAll('.option-btn').forEach(btn => {
                if (parseInt(btn.getAttribute('data-val')) === value) btn.classList.add('selected');
                else btn.classList.remove('selected');
            });

            nextQuestion();
        }

        function nextQuestion() {
            setTimeout(() => {
                if (currentQIndex < questions.length - 1) {
                    currentQIndex++;
                    renderQuestion();
                } else {
                    showReviewPage();
                }
                isTransitioning = false;
            }, 200); // Short delay
        }

        function prevQuestion() {
            if (currentQIndex > 0) {
                currentQIndex--;
                renderQuestion();
            }
        }

        function skipQuestion() {
            // Keep answer as null (or whatever it was)
            // Just move next
            if (currentQIndex < questions.length - 1) {
                currentQIndex++;
                renderQuestion();
            } else {
                showReviewPage();
            }
        }

        // --- Review Page Logic ---
        function showReviewPage() {
            const grid = document.getElementById('review-grid');
            grid.innerHTML = "";
            let answeredCount = 0;

            userAnswers.forEach((ans, idx) => {
                const item = document.createElement('div');
                item.className = `review-item ${ans !== null ? 'answered' : 'skipped'}`;
                item.innerText = idx + 1;
                item.onclick = () => jumpToQuestion(idx);
                grid.appendChild(item);
                if (ans !== null) answeredCount++;
            });

            document.getElementById('review-alert').style.display = 'none';
            switchPage('page-review');
        }

        function jumpToQuestion(idx) {
            currentQIndex = idx;
            switchPage('page-quiz');
            renderQuestion();
        }

        function backToQuizFromReview() {
            // Go to first unanswered, or last question if all answered
            const firstUnanswered = userAnswers.indexOf(null);
            if (firstUnanswered !== -1) {
                currentQIndex = firstUnanswered;
            } else {
                currentQIndex = questions.length - 1;
            }
            switchPage('page-quiz');
            renderQuestion();
        }

        function calculateAndShowResult() {
            // Validate
            if (userAnswers.includes(null)) {
                document.getElementById('review-alert').style.display = 'block';
                return; // Don't proceed
            }

            switchPage('page-loading');
            
            // Calculate Scores
            let scores = { R: 0, D: 0, H: 0, S: 0 };
            userAnswers.forEach((ans, idx) => {
                const type = questions[idx].type;
                scores[type] += ans;
            });

            // Logic same as before...
            // Max score per category is 4 * 4 = 16. Avg is sum / 4
            const avgR = scores.R / 4;
            const avgD = scores.D / 4;
            const avgH = scores.H / 4;
            const avgS = scores.S / 4;

            const rChar = avgR > 2.5 ? 'R' : 'r';
            const dChar = avgD > 2.5 ? 'D' : 'd';
            const hChar = avgH > 2.5 ? 'H' : 'h';
            const sChar = avgS > 2.5 ? 'S' : 's';
            
            userResultCode = rChar + dChar + hChar + sChar;
            const resultData = archetypes[userResultCode];

            // Render
            setTimeout(() => {
                document.getElementById('result-code').innerText = userResultCode.split('').join(' ');
                document.getElementById('result-title').innerText = resultData.title;
                document.getElementById('lin-quote').innerText = `${resultData.quote}`;
                document.getElementById('desc-box').innerText = resultData.desc;

                updateStat('r', avgR);
                updateStat('d', avgD);
                updateStat('h', avgH);
                updateStat('s', avgS);
                drawRadar(avgR, avgD, avgH, avgS);

                switchPage('page-result');
            }, 1200);
        }

        // Stats & UI Helpers (Same as before)
        function updateStat(type, avg) {
            const pct = (avg / 4) * 100;
            document.getElementById(`score-${type}`).innerText = avg.toFixed(1);
            document.getElementById(`bar-${type}`).style.width = `${pct}%`;
        }

        function drawRadar(r, d, h, s) {
            const getPt = (val, axis) => {
                const len = (val / 4) * 40;
                if (axis === 'top') return `50,${50 - len}`;
                if (axis === 'right') return `${50 + len},50`;
                if (axis === 'bottom') return `50,${50 + len}`;
                if (axis === 'left') return `${50 - len},50`;
            };

            const p1 = getPt(r, 'top');
            const p2 = getPt(d, 'right');
            const p3 = getPt(h, 'bottom');
            const p4 = getPt(s, 'left');

            document.getElementById('radar-poly').setAttribute('points', `${p1} ${p2} ${p3} ${p4}`);
        }

        // --- Gallery Logic ---
        function showGallery() {
            const container = document.getElementById('gallery-container');
            container.innerHTML = ""; 

            const codes = Object.keys(archetypes).sort();

            codes.forEach(code => {
                const data = archetypes[code];
                const isUser = (code === userResultCode);
                const bgStyle = isUser ? "border: 2px solid var(--accent-r); background: #FAF5F2;" : ""; 
                
                const chars = code.split('');
                const badgesHtml = chars.map(char => {
                    const isHigh = char === char.toUpperCase();
                    const letter = char.toUpperCase();
                    let color = '';
                    if (letter === 'R') color = 'var(--accent-r)';
                    if (letter === 'D') color = 'var(--accent-d)';
                    if (letter === 'H') color = 'var(--accent-h)';
                    if (letter === 'S') color = 'var(--accent-s)';
                    
                    const style = isHigh 
                        ? `background:${color}; border-color:${color};` 
                        : `background:transparent; color:${color}; border-color:${color}; opacity: 0.6;`;
                        
                    return `<span class="g-badge ${isHigh?'high':'low'}" style="${style}">${letter}${isHigh?'â†‘':'â†“'}</span>`;
                }).join('');

                const html = `
                    <div class="gallery-item" style="${bgStyle}" onclick="alert('${data.title}\\n\\n${data.quote}')">
                        <div class="g-header">
                            <div class="g-title">${data.title} ${isUser ? '<span style="font-size:12px;color:var(--accent-r);">(ä½ )</span>' : ''}</div>
                            <div class="g-badges">${badgesHtml}</div>
                        </div>
                        <div class="g-desc">${data.desc}</div>
                    </div>
                `;
                container.innerHTML += html;
            });

            switchPage('page-gallery');
        }

        function backToResult() {
            switchPage('page-result');
        }

    </script>
</body>
</html>
